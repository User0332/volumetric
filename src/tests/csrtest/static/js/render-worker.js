// Note: This file was automatically generated by the volumetric CLI tool and should NOT be removed or edited if CSR support is required.

import { loadPyodide } from "https://cdn.jsdelivr.net/pyodide/v0.27.7/full/pyodide.mjs";

const pyodidePromise = loadPyodide();

let volumetric = null;
let update = null;

onmessage = async (ev) => {
	if (ev.data.type === "init") {
		const pyodide = await pyodidePromise;
		await pyodide.loadPackage("micropip");

		const python = ev.data.code;
		update = await pyodide.runPythonAsync(python);
		volumetric = pyodide.pyimport("volumetric");

		postMessage("ready");
	} else if (ev.data.type === "start") {
		while (true) {
			volumetric.csr.clear_convd();
			const newHTML = update().toString();

			postMessage({ newHTML });
		}
	}
};